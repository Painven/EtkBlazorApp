@using EtkBlazorApp.Components.Controls.Products
@page "/"

<ProductsGridDisplayer Products="@lastAddedProducts" Title="Последние добавленные товары" MaxDisplayCount=4 />
<ProductsGridDisplayer Products="@bestsellerProducts" Title="Наиболее продаваемые товары" MaxDisplayCount=4 />

@code {

    List<ProductViewModel> lastAddedProducts = null;
    List<ProductViewModel> bestsellerProducts = null;
    [Inject] public IMapper Mapper { get; set; }
    [Inject] public IProductStorage ProductStorage { get; set; }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            lastAddedProducts = Mapper.Map<List<ProductViewModel>>(await ProductStorage.GetLastAddedProducts(4));
            bestsellerProducts = Mapper.Map<List<ProductViewModel>>(await ProductStorage.GetBestsellersBySum(4, 31));
            StateHasChanged();
        }
    }
}