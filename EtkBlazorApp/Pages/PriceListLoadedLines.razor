@page "/loaded-price-list-details/{TemplateGuid}"

@if (templateInformation != null)
{
    <img src="@templateInformation.image" 
         style="width: 300px; margin-bottom: 20px; border: 1px solid lightgray;"
         class="rounded mx-auto d-block">
}

@if (priceLines == null)
{
    <LoadingSpinner></LoadingSpinner>
}
else
{
@if (!string.IsNullOrWhiteSpace(singleManufacturer))
{
    <h2>Производитель "@singleManufacturer"</h2>
}
else
{
    <div class="price-list-template-manufacturers">
        <button type="button" class="btn btn-@(filteredManufacturer == null ? "warning" : "primary") mx-1 my-2" @onclick="@(e => ApplyManufacturerFilter(null))">
            Все <span class="badge badge-pill badge-info">@source.Count</span>
        </button>

        @foreach (var kvp in productsByBrand)
        {
            <button type="button"
                    class="btn btn-@(filteredManufacturer == kvp.Key ? "warning" : "primary") mx-1 my-2" 
                    @onclick="@(e => ApplyManufacturerFilter(kvp.Key))">
                @kvp.Key <span class="badge badge-pill badge-info">@kvp.Value</span>
            </button>
        }
    </div>
}

<div style="overflow-y: visible; height: 900px;">
    <table class="table table-striped table-bordered uploaded-price-list-lines-table">
        <thead class="thead-etk">
            <tr>
                @if (hasManufacturerColumn)
                {
                    <th>Производитель</th>
                }
                @if (hasNameColumn)
                {
                    <th>Товар</th>
                }
                <th>Артикул</th>
                @if (hasModelColumn)
                {
                    <th>Модель</th>
                }
                @if (hasQuantityColumn)
                {
                    <th>Количество</th>
                }
                @if (hasPriceColumn)
                {
                    <th>Цена</th>
                    <th>Валюта</th>
                }
            </tr>
        </thead>
        <tbody>
            <Virtualize Context="line" Items="@priceLines" ItemSize="20" TItem="PriceLine" OverscanCount="25" @key="TemplateGuid">
                <tr @key="RowGuids[line].ToString()">
                    @if (hasManufacturerColumn)
                    {
                        <td>@line.Manufacturer</td>
                    }
                    @if (hasNameColumn)
                    {
                        <td>@line.Name</td>
                    }
                    <td>
                        <button class="btn btn-sm btn-outline-primary mx-1" @onclick="@( e => SearchSkuOnWebsite("findBySku", line.Sku))">
                            <span class="oi oi-magnifying-glass"></span>
                        </button>
                        @line.Sku
                    </td>
                    @if (hasModelColumn)
                    {
                        <td>
                            <button class="btn btn-sm btn-outline-primary mx-1" @onclick="@( e => SearchSkuOnWebsite("findByModel", line.Model))">
                                <span class="oi oi-magnifying-glass"></span>
                            </button>
                            @line.Model
                        </td>
                    }
                    @if (hasQuantityColumn)
                    {
                        <td>@line.Quantity</td>
                    }
                    @if (hasPriceColumn)
                    {
                        <td>@line.Price</td>
                        <td>@line.Currency</td>
                    }
                </tr>
            </Virtualize>
        </tbody>
    </table>
</div>
}